# Dark Mode Implementation Plan

> **For Claude:** REQUIRED SUB-SKILL: Use superpowers:executing-plans to implement this plan task-by-task.

**Goal:** Add a toolbar toggle button that switches the app between light and dark themes, persisting the choice across restarts, including the WebView2 preview panel.

**Architecture:** Two XAML `ResourceDictionary` files (`Themes/Light.xaml`, `Themes/Dark.xaml`) define named brush keys. XAML styles use `{DynamicResource}` bindings so WPF propagates the swap automatically. Code-behind controls (text boxes, splitters, panel labels) are updated explicitly via `ApplyThemeToTab()` after each dictionary swap. A static `ThemeManager` class owns load/save/apply. `MarkdownRenderer.ToHtml()` receives an `isDark` flag to select the correct CSS.

**Tech Stack:** C# 12, WPF .NET 8, no test framework (build + manual verification).

---

### Task 1: Create theme resource dictionaries

**Files:**
- Create: `Themes/Light.xaml`
- Create: `Themes/Dark.xaml`

**Step 1: Create `Themes/Light.xaml`**

```xml
<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <SolidColorBrush x:Key="AppBackground"         Color="#F5F5F5"/>
    <SolidColorBrush x:Key="PanelBackground"       Color="#FFFFFF"/>
    <SolidColorBrush x:Key="PanelAltBackground"    Color="#FAFAFA"/>
    <SolidColorBrush x:Key="PanelHeaderBackground" Color="#F5F5F5"/>
    <SolidColorBrush x:Key="PanelHeaderForeground" Color="#888888"/>
    <SolidColorBrush x:Key="TextForeground"        Color="#1E1E1E"/>
    <SolidColorBrush x:Key="TabBarBackground"      Color="#F2F2F2"/>
    <SolidColorBrush x:Key="TabBackground"         Color="#E0E0E0"/>
    <SolidColorBrush x:Key="TabHoverBackground"    Color="#EFEFEF"/>
    <SolidColorBrush x:Key="TabSelectedBackground" Color="#FFFFFF"/>
    <SolidColorBrush x:Key="TabHeaderForeground"   Color="#222222"/>
    <SolidColorBrush x:Key="StatusBarBackground"   Color="#EBEBEB"/>
    <SolidColorBrush x:Key="StatusBarForeground"   Color="#666666"/>
    <SolidColorBrush x:Key="SplitterBackground"    Color="#DDDDDD"/>
    <SolidColorBrush x:Key="BorderColor"           Color="#D0D0D0"/>

</ResourceDictionary>
```

**Step 2: Create `Themes/Dark.xaml`**

```xml
<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml">

    <SolidColorBrush x:Key="AppBackground"         Color="#1E1E2E"/>
    <SolidColorBrush x:Key="PanelBackground"       Color="#252535"/>
    <SolidColorBrush x:Key="PanelAltBackground"    Color="#2A2A3A"/>
    <SolidColorBrush x:Key="PanelHeaderBackground" Color="#1A1A28"/>
    <SolidColorBrush x:Key="PanelHeaderForeground" Color="#6A6A8A"/>
    <SolidColorBrush x:Key="TextForeground"        Color="#D4D4D4"/>
    <SolidColorBrush x:Key="TabBarBackground"      Color="#181825"/>
    <SolidColorBrush x:Key="TabBackground"         Color="#2A2A3A"/>
    <SolidColorBrush x:Key="TabHoverBackground"    Color="#35354A"/>
    <SolidColorBrush x:Key="TabSelectedBackground" Color="#313145"/>
    <SolidColorBrush x:Key="TabHeaderForeground"   Color="#CCCCCC"/>
    <SolidColorBrush x:Key="StatusBarBackground"   Color="#181825"/>
    <SolidColorBrush x:Key="StatusBarForeground"   Color="#888888"/>
    <SolidColorBrush x:Key="SplitterBackground"    Color="#383850"/>
    <SolidColorBrush x:Key="BorderColor"           Color="#383850"/>

</ResourceDictionary>
```

**Step 3: Build**

```bash
dotnet build C:\Users\daniel.iglesias\source\repos\MdConverter\MdConverter.csproj
```
Expected: 0 errors (dictionaries aren't referenced yet â€” that's fine).

**Step 4: Commit**

```bash
cd "C:\Users\daniel.iglesias\source\repos\MdConverter" && git add Themes/ && git commit -m "feat: add Light and Dark theme resource dictionaries"
```

---

### Task 2: Wire App.xaml + create ThemeManager

**Files:**
- Modify: `App.xaml`
- Create: `ThemeManager.cs`

**Step 1: Update `App.xaml` to merge the light theme by default**

Replace the empty `<Application.Resources>` block with:

```xml
<Application.Resources>
    <ResourceDictionary>
        <ResourceDictionary.MergedDictionaries>
            <ResourceDictionary Source="Themes/Light.xaml"/>
        </ResourceDictionary.MergedDictionaries>
    </ResourceDictionary>
</Application.Resources>
```

**Step 2: Create `ThemeManager.cs`**

```csharp
using System.IO;
using System.Windows;

namespace MdConverter;

public static class ThemeManager
{
    private static readonly string SettingsPath = Path.Combine(
        Environment.GetFolderPath(Environment.SpecialFolder.ApplicationData),
        "MdConverter", "theme.txt");

    public static string Current { get; private set; } = "light";

    public static void Load()
    {
        try
        {
            if (File.Exists(SettingsPath))
                Current = File.ReadAllText(SettingsPath).Trim().ToLower() == "dark" ? "dark" : "light";
        }
        catch { /* default to light on any error */ }
    }

    public static void Apply(string theme)
    {
        Current = theme == "dark" ? "dark" : "light";

        var uri  = new Uri($"Themes/{(Current == "dark" ? "Dark" : "Light")}.xaml", UriKind.Relative);
        var dict = new ResourceDictionary { Source = uri };

        var merged   = Application.Current.Resources.MergedDictionaries;
        var existing = merged.FirstOrDefault(d =>
            d.Source?.OriginalString.Contains("Themes/") == true);

        if (existing is not null) merged.Remove(existing);
        merged.Add(dict);
    }

    public static void Save()
    {
        try
        {
            Directory.CreateDirectory(Path.GetDirectoryName(SettingsPath)!);
            File.WriteAllText(SettingsPath, Current);
        }
        catch { /* ignore save errors */ }
    }
}
```

**Step 3: Build**

```bash
dotnet build C:\Users\daniel.iglesias\source\repos\MdConverter\MdConverter.csproj
```
Expected: 0 errors.

**Step 4: Commit**

```bash
cd "C:\Users\daniel.iglesias\source\repos\MdConverter" && git add App.xaml ThemeManager.cs && git commit -m "feat: add ThemeManager and wire default light theme in App.xaml"
```

---

### Task 3: Update MainWindow.xaml â€” DynamicResource + ToggleTheme button

**Files:**
- Modify: `MainWindow.xaml`

**Step 1: Update `Window` root element**

Find:
```xml
Background="#F5F5F5"
```
Replace with:
```xml
Background="{DynamicResource AppBackground}"
```

**Step 2: Update `DocTabItem` style**

Find and replace these three Setter/Trigger values in the `DocTabItem` style:

| Find | Replace |
|---|---|
| `Value="#E0E0E0"` (the default Background setter) | `Value="{DynamicResource TabBackground}"` |
| `Value="White"` (IsSelected trigger Background) | `Value="{DynamicResource TabSelectedBackground}"` |
| `Value="#EFEFEF"` (IsMouseOver trigger Background) | `Value="{DynamicResource TabHoverBackground}"` |

Leave `Value="#0078D4"` (the blue tab accent border) unchanged â€” it is theme-neutral.

**Step 3: Update `DocTabControl` style template**

Find and replace in the `DocTabControl` template:

| Find | Replace |
|---|---|
| `Background="#F2F2F2"` (TabPanel row border) | `Background="{DynamicResource TabBarBackground}"` |
| `Background="White"` (content area border) | `Background="{DynamicResource PanelBackground}"` |
| `BorderBrush="#D0D0D0"` (content area border) | `BorderBrush="{DynamicResource BorderColor}"` |

**Step 4: Update status bar**

Find:
```xml
<Border Grid.Row="2" Margin="0"
        Background="#EBEBEB" Padding="10,5">
```
Replace with:
```xml
<Border Grid.Row="2" Margin="0"
        Background="{DynamicResource StatusBarBackground}" Padding="10,5">
```

Find:
```xml
Foreground="#666"
```
Replace with:
```xml
Foreground="{DynamicResource StatusBarForeground}"
```

Find:
```xml
Foreground="#888"
```
Replace with:
```xml
Foreground="{DynamicResource StatusBarForeground}"
```

**Step 5: Add `ToggleTheme` button to the toolbar**

In the right-docked `StackPanel`, find the existing `<Separator Style="{StaticResource ToolbarSep}" Margin="0,8,10,8"/>` and add the theme button **before** it:

```xml
<ToggleButton x:Name="ToggleTheme"
              Content="ðŸŒ™ Dark"
              Style="{StaticResource PanelToggle}"
              Margin="0,0,4,0"
              Click="ToggleTheme_Click"
              ToolTip="Switch to dark mode"/>
```

**Step 6: Build**

```bash
dotnet build C:\Users\daniel.iglesias\source\repos\MdConverter\MdConverter.csproj
```
Expected: 1 error â€” `ToggleTheme_Click` handler not yet defined. That's OK; it will be added in Task 5. If there are other errors, fix them now.

Actually to get a clean build, add a stub handler in `MainWindow.xaml.cs` temporarily:

```csharp
private void ToggleTheme_Click(object sender, RoutedEventArgs e) { }
```

Then build to confirm 0 errors.

**Step 7: Commit**

```bash
cd "C:\Users\daniel.iglesias\source\repos\MdConverter" && git add MainWindow.xaml MainWindow.xaml.cs && git commit -m "feat: replace hardcoded colors with DynamicResource and add ToggleTheme button"
```

---

### Task 4: Extend TabState + update WrapInPanel

**Files:**
- Modify: `MainWindow.xaml.cs`

**Step 1: Add new fields to the `TabState` inner class**

Find the `TabState` class. Add these five properties after the existing ones (after `IsViewMode`):

```csharp
public required TextBlock HeaderNameLabel  { get; init; }
public required TextBox   HeaderNameEditor { get; init; }
public required TextBlock SourceLabel      { get; init; }
public required TextBlock MdLabel          { get; init; }
public required TextBlock PreviewLabel     { get; init; }
```

**Step 2: Change `WrapInPanel` return type to a tuple**

Find:
```csharp
private static Grid WrapInPanel(UIElement content, string label, int column)
```

Replace the signature and return statement so it returns `(Grid, TextBlock)`:

```csharp
private static (Grid Panel, TextBlock Label) WrapInPanel(UIElement content, string label, int column)
{
    var g = new Grid();
    g.RowDefinitions.Add(new RowDefinition { Height = GridLength.Auto });
    g.RowDefinitions.Add(new RowDefinition { Height = new GridLength(1, GridUnitType.Star) });

    var lbl = new TextBlock
    {
        Text       = label,
        FontSize   = 10,
        FontWeight = FontWeights.SemiBold,
        Foreground = new SolidColorBrush(Color.FromRgb(0x88, 0x88, 0x88)),
        Padding    = new Thickness(10, 4, 10, 4),
        Background = new SolidColorBrush(Color.FromRgb(0xF5, 0xF5, 0xF5))
    };

    Grid.SetRow(lbl, 0);
    Grid.SetRow((FrameworkElement)content, 1);
    g.Children.Add(lbl);
    g.Children.Add((UIElement)content);
    Grid.SetColumn(g, column);
    return (g, lbl);
}
```

**Step 3: Update the three `WrapInPanel` call sites in `MakeDocumentTab`**

Find:
```csharp
contentGrid.Children.Add(WrapInPanel(inputBox,       "SOURCE",   0));
contentGrid.Children.Add(splitter1);
contentGrid.Children.Add(WrapInPanel(outputBox,      "MARKDOWN", 2));
contentGrid.Children.Add(splitter2);
contentGrid.Children.Add(WrapInPanel(previewWebView, "PREVIEW",  4));
```

Replace with:
```csharp
var (sourcePanel,  sourceLabel)  = WrapInPanel(inputBox,       "SOURCE",   0);
var (mdPanel,      mdLabel)      = WrapInPanel(outputBox,      "MARKDOWN", 2);
var (previewPanel, previewLabel) = WrapInPanel(previewWebView, "PREVIEW",  4);

contentGrid.Children.Add(sourcePanel);
contentGrid.Children.Add(splitter1);
contentGrid.Children.Add(mdPanel);
contentGrid.Children.Add(splitter2);
contentGrid.Children.Add(previewPanel);
```

**Step 4: Add the new fields to the `TabState` initialiser**

Find the `var state = new TabState { ... }` block and add the five new fields at the end:

```csharp
HeaderNameLabel  = nameLabel,
HeaderNameEditor = nameEditor,
SourceLabel      = sourceLabel,
MdLabel          = mdLabel,
PreviewLabel     = previewLabel,
```

**Step 5: Build**

```bash
dotnet build C:\Users\daniel.iglesias\source\repos\MdConverter\MdConverter.csproj
```
Expected: 0 errors.

**Step 6: Commit**

```bash
cd "C:\Users\daniel.iglesias\source\repos\MdConverter" && git add MainWindow.xaml.cs && git commit -m "refactor: extend TabState with label refs and update WrapInPanel return type"
```

---

### Task 5: ApplyThemeToTab + toggle handler + startup wiring

**Files:**
- Modify: `MainWindow.xaml.cs`

**Step 1: Add `ApplyThemeToTab` method**

Add this method near the other "Active-tab helpers" (after `GetActiveTabState`):

```csharp
private static void ApplyThemeToTab(TabState state)
{
    var panelBg    = (SolidColorBrush)Application.Current.Resources["PanelBackground"];
    var panelAlt   = (SolidColorBrush)Application.Current.Resources["PanelAltBackground"];
    var headerBg   = (SolidColorBrush)Application.Current.Resources["PanelHeaderBackground"];
    var headerFg   = (SolidColorBrush)Application.Current.Resources["PanelHeaderForeground"];
    var textFg     = (SolidColorBrush)Application.Current.Resources["TextForeground"];
    var tabFg      = (SolidColorBrush)Application.Current.Resources["TabHeaderForeground"];
    var splitterBg = (SolidColorBrush)Application.Current.Resources["SplitterBackground"];

    // Text editors
    state.InputBox.Background  = panelBg;
    state.InputBox.Foreground  = textFg;
    state.OutputBox.Background = panelAlt;
    state.OutputBox.Foreground = textFg;

    // Splitters
    state.Splitter1.Background = splitterBg;
    state.Splitter2.Background = splitterBg;

    // Panel header labels
    state.SourceLabel.Background  = headerBg;
    state.SourceLabel.Foreground  = headerFg;
    state.MdLabel.Background      = headerBg;
    state.MdLabel.Foreground      = headerFg;
    state.PreviewLabel.Background = headerBg;
    state.PreviewLabel.Foreground = headerFg;

    // Tab header name label and editor
    state.HeaderNameLabel.Foreground  = tabFg;
    state.HeaderNameEditor.Foreground = tabFg;
    state.HeaderNameEditor.Background = panelBg;
}
```

**Step 2: Call `ApplyThemeToTab` at the end of `MakeDocumentTab`, just before `return tab`**

Find the line `header.ContextMenu = contextMenu;` near the end of `MakeDocumentTab`. After it, add:

```csharp
ApplyThemeToTab(state);
```

**Step 3: Replace the stub `ToggleTheme_Click` with the real handler**

Replace:
```csharp
private void ToggleTheme_Click(object sender, RoutedEventArgs e) { }
```

With:
```csharp
private void ToggleTheme_Click(object sender, RoutedEventArgs e)
{
    string newTheme = ThemeManager.Current == "light" ? "dark" : "light";
    ThemeManager.Apply(newTheme);
    ThemeManager.Save();
    UpdateThemeButton();

    foreach (var state in _tabStates.Values)
        ApplyThemeToTab(state);

    RefreshPreview();
}

private void UpdateThemeButton()
{
    ToggleTheme.Content   = ThemeManager.Current == "dark" ? "â˜€ Light" : "ðŸŒ™ Dark";
    ToggleTheme.IsChecked = ThemeManager.Current == "dark";
    ToggleTheme.ToolTip   = ThemeManager.Current == "dark" ? "Switch to light mode" : "Switch to dark mode";
}
```

**Step 4: Update `Window_Loaded` to load and apply the persisted theme**

Find:
```csharp
private void Window_Loaded(object sender, RoutedEventArgs e)
{
    InitializeTabs();
}
```

Replace with:
```csharp
private void Window_Loaded(object sender, RoutedEventArgs e)
{
    ThemeManager.Load();
    ThemeManager.Apply(ThemeManager.Current);
    UpdateThemeButton();
    InitializeTabs();
}
```

**Step 5: Build**

```bash
dotnet build C:\Users\daniel.iglesias\source\repos\MdConverter\MdConverter.csproj
```
Expected: 0 errors.

**Step 6: Quick manual check**

Run the app. The UI should look identical to before (light mode default). Click "ðŸŒ™ Dark" â€” the window background, tabs, text boxes, and status bar should switch to dark colors. Click "â˜€ Light" â€” it should switch back. Close and reopen the app â€” the last chosen theme should be restored.

**Step 7: Commit**

```bash
cd "C:\Users\daniel.iglesias\source\repos\MdConverter" && git add MainWindow.xaml.cs && git commit -m "feat: implement ApplyThemeToTab, toggle handler, and startup theme loading"
```

---

### Task 6: Update MarkdownRenderer + RefreshPreview

**Files:**
- Modify: `Converter/MarkdownRenderer.cs`
- Modify: `MainWindow.xaml.cs` (RefreshPreview only)

**Step 1: Update `MarkdownRenderer.cs`**

Replace the entire file content with:

```csharp
using Markdig;

namespace MdConverter.Converter;

/// <summary>
/// Converts a Markdown string to a self-contained HTML page for WebView2 preview.
/// </summary>
public static class MarkdownRenderer
{
    private static readonly MarkdownPipeline Pipeline = new MarkdownPipelineBuilder()
        .UseAdvancedExtensions()
        .UseEmojiAndSmiley()
        .Build();

    public static string ToHtml(string markdown, bool isDark = false)
    {
        if (string.IsNullOrWhiteSpace(markdown))
            return WrapInPage("<p style='color:#888;font-style:italic'>No content yet.</p>", isDark);

        var body = Markdig.Markdown.ToHtml(markdown, Pipeline);
        return WrapInPage(body, isDark);
    }

    private static string WrapInPage(string body, bool isDark)
    {
        string bg        = isDark ? "#1e1e2e" : "#ffffff";
        string fg        = isDark ? "#cdd6f4" : "#1e1e1e";
        string headingFg = isDark ? "#cdd6f4" : "#111111";
        string h1Border  = isDark ? "#45475a" : "#e0e0e0";
        string h2Border  = isDark ? "#45475a" : "#e8e8e8";
        string codeBg    = isDark ? "#313244" : "#f3f3f3";
        string preBg     = isDark ? "#11111b" : "#1e1e1e";
        string preFg     = isDark ? "#cdd6f4" : "#d4d4d4";
        string bqBg      = isDark ? "#1e2030" : "#f0f7ff";
        string bqBorder  = isDark ? "#89b4fa" : "#0078d4";
        string hrColor   = isDark ? "#45475a" : "#e0e0e0";
        string thBg      = isDark ? "#313244" : "#f0f4f8";
        string tdBorder  = isDark ? "#45475a" : "#d0d7de";
        string tdEvenBg  = isDark ? "#252535" : "#f9fbfc";
        string trHoverBg = isDark ? "#2a2a3a" : "#eef4fb";
        string linkFg    = isDark ? "#89b4fa" : "#0078d4";

        return $$"""
            <!DOCTYPE html>
            <html lang="en">
            <head>
            <meta charset="UTF-8"/>
            <meta name="viewport" content="width=device-width, initial-scale=1"/>
            <style>
              *, *::before, *::after { box-sizing: border-box; }

              body {
                font-family: -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
                font-size: 15px;
                line-height: 1.65;
                color: {{fg}};
                background: {{bg}};
                max-width: 860px;
                margin: 0 auto;
                padding: 24px 28px 48px;
              }

              h1 { font-size: 1.9em; border-bottom: 2px solid {{h1Border}}; padding-bottom: .3em; margin-top: 1em; }
              h2 { font-size: 1.45em; border-bottom: 1px solid {{h2Border}}; padding-bottom: .25em; margin-top: 1.4em; }
              h3 { font-size: 1.15em; margin-top: 1.2em; }
              h1, h2, h3 { font-weight: 700; color: {{headingFg}}; }

              p { margin: .6em 0; }

              a { color: {{linkFg}}; text-decoration: none; }
              a:hover { text-decoration: underline; }

              code {
                font-family: "Cascadia Code", Consolas, "Courier New", monospace;
                font-size: .88em;
                background: {{codeBg}};
                padding: 2px 5px;
                border-radius: 3px;
              }

              pre {
                background: {{preBg}};
                color: {{preFg}};
                padding: 14px 16px;
                border-radius: 6px;
                overflow-x: auto;
                font-size: .88em;
              }
              pre code { background: none; padding: 0; color: inherit; }

              blockquote {
                border-left: 4px solid {{bqBorder}};
                margin: 1em 0;
                padding: .4em 1em;
                color: {{fg}};
                background: {{bqBg}};
                border-radius: 0 4px 4px 0;
              }

              hr {
                border: none;
                border-top: 2px solid {{hrColor}};
                margin: 1.5em 0;
              }

              ul, ol { padding-left: 1.6em; margin: .5em 0; }
              li { margin: .2em 0; }

              table {
                border-collapse: collapse;
                width: 100%;
                margin: 1em 0;
                font-size: .93em;
              }
              th {
                background: {{thBg}};
                font-weight: 600;
                text-align: left;
                padding: 8px 12px;
                border: 1px solid {{tdBorder}};
                color: {{fg}};
              }
              td {
                padding: 7px 12px;
                border: 1px solid {{tdBorder}};
                vertical-align: top;
                color: {{fg}};
              }
              tr:nth-child(even) td { background: {{tdEvenBg}}; }
              tr:hover td { background: {{trHoverBg}}; }

              strong { font-weight: 700; }
              em     { font-style: italic; }
            </style>
            </head>
            <body>
            {{body}}
            </body>
            </html>
            """;
    }
}
```

**Step 2: Update `RefreshPreview` in `MainWindow.xaml.cs`**

Find:
```csharp
state.PreviewWebView.CoreWebView2.NavigateToString(MarkdownRenderer.ToHtml(state.OutputBox.Text));
```

Replace with:
```csharp
state.PreviewWebView.CoreWebView2.NavigateToString(
    MarkdownRenderer.ToHtml(state.OutputBox.Text, ThemeManager.Current == "dark"));
```

**Step 3: Build**

```bash
dotnet build C:\Users\daniel.iglesias\source\repos\MdConverter\MdConverter.csproj
```
Expected: 0 errors.

**Step 4: Commit**

```bash
cd "C:\Users\daniel.iglesias\source\repos\MdConverter" && git add Converter/MarkdownRenderer.cs MainWindow.xaml.cs && git commit -m "feat: add dark CSS to MarkdownRenderer and pass isDark to RefreshPreview"
```

---

### Task 7: End-to-end smoke test

No code changes â€” verification only.

**Checklist:**

1. **Default state:** launch app fresh (no saved theme) â†’ light mode, button reads "ðŸŒ™ Dark"
2. **Toggle to dark:** click "ðŸŒ™ Dark" â†’ window background, tabs, text boxes, status bar, panel headers all go dark; button reads "â˜€ Light"
3. **Toggle back:** click "â˜€ Light" â†’ everything returns to light
4. **Persistence:** switch to dark, close app via tray "Exit", reopen â†’ starts in dark mode; button reads "â˜€ Light"
5. **New tab in dark:** while in dark mode, open a new tab â†’ it opens with dark colors (not white)
6. **Preview dark:** enable Preview panel while in dark mode â†’ preview renders on dark background with light text
7. **Preview toggle:** switch theme while Preview is open â†’ preview re-renders in new theme immediately
8. **Comparison mode:** dock a tab in dark mode â†’ purple strip visible, both panes dark; undock â†’ returns cleanly
9. **Open .md file:** open a file in dark mode â†’ content visible with correct dark colors
10. **Light mode preview:** switch to light, open Preview â†’ preview shows on white background

If any check fails, debug and fix before proceeding to final commit.

**Final commit (if any fixes needed):**

```bash
git add -p
git commit -m "fix: <description>"
```
